{% extends 'base.html' %}
{% block content %}
<h3>Punto de Venta</h3>
<form method="post" class="row g-2 mb-3">
  <input type="hidden" name="sale_id" value="{{ sale.id if sale else '' }}">
  <div class="col-3">
    <input class="form-control" name="product_id" placeholder="ID Producto">
  </div>
  <div class="col-2">
    <input class="form-control" name="qty" type="number" value="1">
  </div>
  <div class="col-3">
    <input class="form-control" name="unit_price_net" type="number" step="0.01" placeholder="Precio Neto">
  </div>
  <div class="col-2">
    <input class="form-control" name="discount" type="number" step="0.01" placeholder="Desc.">
  </div>
  <div class="col-2">
    <button class="btn btn-primary w-100">Agregar</button>
  </div>
</form>

{% if sale %}
<table class="table table-sm">
  <thead><tr><th>Producto</th><th>Cant</th><th>Neto</th><th>Desc</th><th>Total l√≠nea</th></tr></thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td>{{ it.product_id }}</td>
      <td>{{ it.qty }}</td>
      <td>{{ it.unit_price_net|clp }}</td>
      <td>{{ it.discount|clp }}</td>
      <td>{{ it.line_total|clp }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div class="mt-3">
  <div>Subtotal Neto: {{ sale.subtotal_net|clp }}</div>
  <div>IVA: {{ sale.vat|clp }}</div>
  <div>Total: {{ sale.total|clp }}</div>
  <form method="post" action="/sales/{{sale.id}}/confirm">
    <button class="btn btn-success">Confirmar Venta</button>
  </form>
  <a class="btn btn-outline-secondary" href="/sales/{{sale.id}}/ticket" target="_blank">Imprimir Ticket</a>
</div>
{% endif %}
{% endblock %}
